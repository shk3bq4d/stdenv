#!/usr/bin/env bash

#cd /lvmr0/keepass/
#/usr/bin/keepass2 mr.kdbx  -preselect:mr.key &>/dev/null </dev/null &
#DIR="$( cd -P "$( dirname "$(readlink -f "${BASH_SOURCE[0]}")" )" && pwd )"
wids=$(xdotool search --class "keepass")
for wid in $wids; do
    name=$(xdotool getwindowname $wid)
    if [[ $name == *"- KeePassXC" ]]; then
        if xdotool windowactivate $wid; then
            exit 0
        fi
    fi
done
DIR=~/bin
set -x
echo "work pc is ${WORK_PC1F}"
if hash keepassxc &>/dev/null; then
    case $(hostname -f) in \
	apr16.ly.lan)
        export QT_SCALE_FACTOR=1.5
		echo "FATAL: to be thought out how to do with team-A, team-B corona"
		exit 1
		;;
	${WORK_PC1F})
        export QT_SCALE_FACTOR=1.5
		;;
    *)
        export QT_SCALE_FACTOR=2
        export QT_SCALE_FACTOR=1
        ;;
    esac
    BIN=keepassxc
    if [[ -f ~/bip/mr.kdbx ]]; then
        cd ~/bip
        if [[ -f $PWD/mr.key ]]; then
            $BIN --keyfile $PWD/mr.key $PWD/mr.kdbx  &>/dev/null </dev/null &
        else
            $BIN $PWD/mr.kdbx  &>/dev/null </dev/null &
        fi
    else
        cd ~/.keepass
        if [[ -f $PWD/mr.key ]]; then
            $BIN --keyfile $PWD/mr.key $PWD/mr.kdbx  &>/dev/null </dev/null &
        else
            $BIN $PWD/mr.kdbx  &>/dev/null </dev/null &
        fi
    fi
elif [[ -x $DIR/KeePassXC-2.2.0-x86_64.AppImage ]]; then
    export QT_SCALE_FACTOR=2
    BIN=$DIR/KeePassXC-2.2.0-x86_64.AppImage
    cd ~/.keepass
    if [[ -f $PWD/mr.key ]]; then
        $BIN --keyfile $PWD/mr.key $PWD/mr.kdbx  &>/dev/null </dev/null &
    else
        $BIN $PWD/mr.kdbx  &>/dev/null </dev/null &
    fi
else
    cd ~/.keepass
    BIN=/usr/bin/keepass2
    $BIN mr.kdbx  &>/dev/null </dev/null &
fi
